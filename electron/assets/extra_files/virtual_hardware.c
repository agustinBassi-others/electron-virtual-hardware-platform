virtual_hardware.c copied