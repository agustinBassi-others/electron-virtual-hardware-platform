<!-- HTML generated using hilite.me -->
<div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008000">/* Copyright 2018, Agustin Bassi.</span>
<span style="color: #008000"> * All rights reserved.</span>
<span style="color: #008000"> *</span>
<span style="color: #008000"> * This file is part of ViHard library, a library of virtual hardware</span>
<span style="color: #008000"> * for Embedded Systems.</span>
<span style="color: #008000"> *</span>
<span style="color: #008000"> * Redistribution and use in source and binary forms, with or without</span>
<span style="color: #008000"> * modification, are permitted provided that the following conditions are met:</span>
<span style="color: #008000"> *</span>
<span style="color: #008000"> * 1. Redistributions of source code must retain the above copyright notice,</span>
<span style="color: #008000"> *    this list of conditions and the following disclaimer.</span>
<span style="color: #008000"> *</span>
<span style="color: #008000"> * 2. Redistributions in binary form must reproduce the above copyright notice,</span>
<span style="color: #008000"> *    this list of conditions and the following disclaimer in the documentation</span>
<span style="color: #008000"> *    and/or other materials provided with the distribution.</span>
<span style="color: #008000"> *</span>
<span style="color: #008000"> * 3. Neither the name of the copyright holder nor the names of its</span>
<span style="color: #008000"> *    contributors may be used to endorse or promote products derived from this</span>
<span style="color: #008000"> *    software without specific prior written permission.</span>
<span style="color: #008000"> *</span>
<span style="color: #008000"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<span style="color: #008000"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span style="color: #008000"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<span style="color: #008000"> * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE</span>
<span style="color: #008000"> * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
<span style="color: #008000"> * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<span style="color: #008000"> * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
<span style="color: #008000"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
<span style="color: #008000"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
<span style="color: #008000"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<span style="color: #008000"> * POSSIBILITY OF SUCH DAMAGE.</span>
<span style="color: #008000"> *</span>
<span style="color: #008000"> */</span>

<span style="color: #008000">/* Date: 2018-10-02 */</span>

<span style="color: #008000">/*==================[inclusions]=============================================*/</span>

<span style="color: #0000ff">#include &quot;sapi.h&quot;</span>
<span style="color: #0000ff">#include &quot;vihard.h&quot;</span>

<span style="color: #008000">/*==================[macros and definitions]=================================*/</span>

<span style="color: #008000">/*==================[internal data declaration]==============================*/</span>

<span style="color: #008000">/*==================[internal functions declaration]=========================*/</span>

<span style="color: #008000">// Ejemplos con GPIOs virtuales</span>
<span style="color: #0000ff">static</span> <span style="color: #2b91af">void</span> RunExample_VhGpioWrite      ();
<span style="color: #0000ff">static</span> <span style="color: #2b91af">void</span> RunExample_VhGpioRead       ();
<span style="color: #0000ff">static</span> <span style="color: #2b91af">void</span> RunExample_VhGpioToggle     ();
<span style="color: #008000">// Ejemplos con entradas y salidas analogicas virtuales</span>
<span style="color: #0000ff">static</span> <span style="color: #2b91af">void</span> RunExample_VhAdcRead        ();
<span style="color: #0000ff">static</span> <span style="color: #2b91af">void</span> RunExample_VhDacWrite       ();
<span style="color: #008000">// Ejemplo de escritura del display 7 segmentos virtual</span>
<span style="color: #0000ff">static</span> <span style="color: #2b91af">void</span> RunExample_Vh7SegmentsWrite ();
<span style="color: #008000">// Ejemplo de escritura del display LCD virtual</span>
<span style="color: #0000ff">static</span> <span style="color: #2b91af">void</span> RunExample_VhLcdWriteString ();

<span style="color: #008000">/*==================[internal data definition]===============================*/</span>

<span style="color: #008000">/*==================[external data definition]===============================*/</span>

<span style="color: #008000">/*==================[internal functions definition]==========================*/</span>

<span style="color: #008000">/**</span>
<span style="color: #008000"> * Enciende o apaga los LEDs virtuales de manera secuencial.</span>
<span style="color: #008000"> */</span>
<span style="color: #0000ff">static</span> <span style="color: #2b91af">void</span> RunExample_VhGpioWrite (){
<span style="color: #0000ff">static</span> <span style="color: #2b91af">uint8_t</span> index = 0;

    <span style="color: #0000ff">if</span> (++index &gt;= 8){
        index = 0;
    }

    <span style="color: #0000ff">if</span> (index == 0){
        Vh_GpioWrite(VH_LED1, TRUE);
    } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (index == 1){
        Vh_GpioWrite(VH_LED2, TRUE);
    } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (index == 2){
        Vh_GpioWrite(VH_LED3, TRUE);
    } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (index == 3){
        Vh_GpioWrite(VH_LED4, TRUE);
    } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (index == 4){
        Vh_GpioWrite(VH_LED1, FALSE);
    } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (index == 5){
        Vh_GpioWrite(VH_LED2, FALSE);
    } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (index == 6){
        Vh_GpioWrite(VH_LED3, FALSE);
    } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (index == 7){
        Vh_GpioWrite(VH_LED4, FALSE);
    } <span style="color: #0000ff">else</span> {
        index = 0;
    }

    delay(200);

}

<span style="color: #008000">/**</span>
<span style="color: #008000"> * Enciende los LEDs VH_LED1, VH_LED2 o VH_LED3 si se</span>
<span style="color: #008000"> * presiona VH_TEC1, VH_TEC2 o VH_TEC3.</span>
<span style="color: #008000"> */</span>
<span style="color: #0000ff">static</span> <span style="color: #2b91af">void</span> RunExample_VhGpioRead (){

    <span style="color: #0000ff">if</span> (!Vh_GpioRead(VH_TEC1)){
        Vh_GpioWrite(VH_LED1, TRUE);
    } <span style="color: #0000ff">else</span> {
        Vh_GpioWrite(VH_LED1, FALSE);
    }
    <span style="color: #0000ff">if</span> (!Vh_GpioRead(VH_TEC2)){
        Vh_GpioWrite(VH_LED2, TRUE);
    } <span style="color: #0000ff">else</span> {
        Vh_GpioWrite(VH_LED2, FALSE);
    }
    <span style="color: #0000ff">if</span> (!Vh_GpioRead(VH_TEC3)){
        Vh_GpioWrite(VH_LED3, TRUE);
    } <span style="color: #0000ff">else</span> {
        Vh_GpioWrite(VH_LED3, FALSE);
    }

}

<span style="color: #008000">/**</span>
<span style="color: #008000"> * Toggle (intercambia) el valor de los 4 LEDs virtuales.</span>
<span style="color: #008000"> */</span>
<span style="color: #0000ff">static</span> <span style="color: #2b91af">void</span> RunExample_VhGpioToggle (){
    Vh_GpioToggle(VH_LED1);
    Vh_GpioToggle(VH_LED2);
    Vh_GpioToggle(VH_LED3);
    Vh_GpioToggle(VH_LED4);
    delay(500);
}

<span style="color: #008000">/**</span>
<span style="color: #008000"> * Enciende o apaga los LEDs virtuales de manera proporcional</span>
<span style="color: #008000"> * al valor leido en el potenciometro VH_ADC_CH1.</span>
<span style="color: #008000"> */</span>
<span style="color: #0000ff">static</span> <span style="color: #2b91af">void</span> RunExample_VhAdcRead (){
    <span style="color: #2b91af">uint16_t</span> adcValue = Vh_AdcRead(VH_ADC_CH1);

    <span style="color: #0000ff">if</span> (adcValue == 0){
        Vh_GpioWrite(VH_LED1, FALSE);
        Vh_GpioWrite(VH_LED2, FALSE);
        Vh_GpioWrite(VH_LED3, FALSE);
        Vh_GpioWrite(VH_LED4, FALSE);
    } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (adcValue &gt;= 0 &amp;&amp; adcValue &lt;= 250){
        Vh_GpioWrite(VH_LED1, TRUE);
        Vh_GpioWrite(VH_LED2, FALSE);
        Vh_GpioWrite(VH_LED3, FALSE);
        Vh_GpioWrite(VH_LED4, FALSE);
    } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (adcValue &gt; 250 &amp;&amp; adcValue &lt;= 500){
        Vh_GpioWrite(VH_LED1, TRUE);
        Vh_GpioWrite(VH_LED2, TRUE);
        Vh_GpioWrite(VH_LED3, FALSE);
        Vh_GpioWrite(VH_LED4, FALSE);
    } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (adcValue &gt; 500 &amp;&amp; adcValue &lt;= 750){
        Vh_GpioWrite(VH_LED1, TRUE);
        Vh_GpioWrite(VH_LED2, TRUE);
        Vh_GpioWrite(VH_LED3, TRUE);
        Vh_GpioWrite(VH_LED4, FALSE);
    } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (adcValue &gt; 750){
        Vh_GpioWrite(VH_LED1, TRUE);
        Vh_GpioWrite(VH_LED2, TRUE);
        Vh_GpioWrite(VH_LED3, TRUE);
        Vh_GpioWrite(VH_LED4, TRUE);
    }

}

<span style="color: #008000">/**</span>
<span style="color: #008000"> * Escribe valores de 0 a 1000 en el VH_DAC_CH1</span>
<span style="color: #008000"> * incrementando de a 100.</span>
<span style="color: #008000"> */</span>
<span style="color: #0000ff">static</span> <span style="color: #2b91af">void</span> RunExample_VhDacWrite (){
    <span style="color: #0000ff">static</span> <span style="color: #2b91af">uint16_t</span> dacValue = 0;

    dacValue += 100;
    <span style="color: #0000ff">if</span> (dacValue &gt; 1000){
        dacValue = 0;
    }

    Vh_DacWrite(VH_DAC_CH1, dacValue);

    delay(200);
}

<span style="color: #008000">/**</span>
<span style="color: #008000"> * Muestra los numeros del 0 al 9 en el display 7 segmentos.</span>
<span style="color: #008000"> */</span>
<span style="color: #0000ff">static</span> <span style="color: #2b91af">void</span> RunExample_Vh7SegmentsWrite (){
    <span style="color: #0000ff">static</span> <span style="color: #2b91af">uint8_t</span> value = <span style="color: #a31515">&#39;0&#39;</span>;

    <span style="color: #0000ff">if</span> (++value &gt; <span style="color: #a31515">&#39;9&#39;</span>){
        value = <span style="color: #a31515">&#39;0&#39;</span>;
    }

    Vh_7SegmentsWrite(VH_7SEG, value);

    delay (500);
}

<span style="color: #008000">/**</span>
<span style="color: #008000"> * Muestra en el display LCD distintos mensajes.</span>
<span style="color: #008000"> */</span>
<span style="color: #0000ff">static</span> <span style="color: #2b91af">void</span> RunExample_VhLcdWriteString    (){
    <span style="color: #0000ff">static</span> LcdLine_t lcdLine = LCD_LINE_THIRD;

    <span style="color: #0000ff">if</span> (++lcdLine &gt; LCD_LINE_THIRD){
        lcdLine = LCD_LINE_ALL;
    }

    <span style="color: #0000ff">if</span> (lcdLine == LCD_LINE_ALL){
        Vh_LcdWriteString(VH_LCD1, LCD_LINE_ALL, <span style="color: #a31515">&quot;Mensaje multilinea desde ViHard&quot;</span>);
    } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (lcdLine == LCD_LINE_FIRST){
        Vh_LcdWriteString(VH_LCD1, LCD_LINE_FIRST, <span style="color: #a31515">&quot;Linea 1&quot;</span>);
    } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (lcdLine == LCD_LINE_SECOND){
        Vh_LcdWriteString(VH_LCD1, LCD_LINE_SECOND, <span style="color: #a31515">&quot;Linea 2&quot;</span>);
    } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (lcdLine == LCD_LINE_THIRD){
        Vh_LcdWriteString(VH_LCD1, LCD_LINE_THIRD, <span style="color: #a31515">&quot;Linea 3&quot;</span>);
    }

    delay(1000);
}

<span style="color: #008000">/*==================[external functions definition]==========================*/</span>

<span style="color: #2b91af">int</span> main(<span style="color: #2b91af">void</span>){
<span style="color: #008000">// Variable para determinar que ejemplo se debe correr</span>
<span style="color: #0000ff">static</span> <span style="color: #2b91af">uint8_t</span> exampleIndex = 0;
<span style="color: #008000">// Arreglo para escribir en el display LCD el ejemplo que se esta ejecutando</span>
<span style="color: #2b91af">char</span> messageExampleRunning [6][55] = {
        <span style="color: #a31515">&quot;Se esta ejecutando el ejemplo GpioWrite()&quot;</span>,
        <span style="color: #a31515">&quot;Se esta ejecutando el ejemplo GpioRead()&quot;</span>,
        <span style="color: #a31515">&quot;Se esta ejecutando el ejemplo GpioToggle()&quot;</span>,
        <span style="color: #a31515">&quot;Se esta ejecutando el ejemplo AdcRead()&quot;</span>,
        <span style="color: #a31515">&quot;Se esta ejecutando el ejemplo DacWrite()&quot;</span>,
        <span style="color: #a31515">&quot;Se esta ejecutando el ejemplo 7SegsWrite()&quot;</span>,
        <span style="color: #a31515">&quot;Se esta ejecutando el ejemplo LcdWriteString()&quot;</span>,
};

    <span style="color: #008000">// Configura la placa EDU-CIAA-NXP</span>
    boardConfig();

    <span style="color: #008000">// Configura la biblioteca ViHard</span>
    Vh_BoardConfig(VIHARD_BAUDRATE);

    <span style="color: #008000">// Muestra un mensaje de bienvenida y espera 5 segundos</span>
    Vh_LcdWriteString(VH_LCD1, LCD_LINE_ALL, <span style="color: #a31515">&quot;Bienvenido a la plataforma ViHard!&quot;</span>);
    delay(5000);

    <span style="color: #008000">// Muestra que ejemplo se esta ejecutando</span>
    Vh_LcdWriteString(VH_LCD1, LCD_LINE_ALL, messageExampleRunning[exampleIndex]);

    <span style="color: #0000ff">while</span>(1) {

        <span style="color: #008000">// Presionando VH_TEC4 en el programa ViHard se van cambiando los ejemplos</span>
        <span style="color: #0000ff">if</span> (!Vh_GpioRead(VH_TEC4)){

            <span style="color: #008000">// Incrementa el indice de los ejemplos y si llega al maximo lo resetea</span>
            <span style="color: #0000ff">if</span> (++exampleIndex == 7){
                exampleIndex = 0;
            }

            <span style="color: #008000">// Muestra en el LCD el ejemplo que se esta ejecutando</span>
            Vh_LcdWriteString(VH_LCD1, LCD_LINE_ALL, messageExampleRunning[exampleIndex]);
            delay(2000);
        }

        <span style="color: #008000">// Dependiendo del valor del indice se ejecutan los diferentes ejemplos</span>
        <span style="color: #0000ff">if</span> (exampleIndex == 0){
            RunExample_VhGpioWrite();
        } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (exampleIndex == 1){
            RunExample_VhGpioRead();
        } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (exampleIndex == 2){
            RunExample_VhGpioToggle();
        } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (exampleIndex == 3){
            RunExample_VhAdcRead();
        } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (exampleIndex == 4){
            RunExample_VhDacWrite();
        } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (exampleIndex == 5){
            RunExample_Vh7SegmentsWrite();
        } <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (exampleIndex == 6){
            RunExample_VhLcdWriteString();
        } <span style="color: #0000ff">else</span> {
            <span style="color: #008000">// Si el valor del ejemplo es desconocido lo pone en 0</span>
            exampleIndex = 0;
        }

    }
    <span style="color: #0000ff">return</span> 0 ;
}

<span style="color: #008000">/*==================[end of file]============================================*/</span>
</pre></div>
    